<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>map[]</title>
  <link href="/css/gisty.css" rel="stylesheet">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-48719488-1');
  ga('send', 'pageview');
  </script>
</head>
<body>
  <div class="wrapper">
    <header class="header">
      <div class="container">
        <h1><a href="/">map[]</a></h1>
      </div>
    </header>
    <div class="body">
      <div class="container">

  <article class="article">
    <h1 class="article-title">CoffeeScript Compiler</h1>
    <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 0001-01-01</small></p> <hr/>
    <div class="article-content">
      

<p><a href="https://github.com/minodisk/coffee-refactor">minodisk/coffee-refactor</a>を作成中に<a href="http://coffeescript.org/documentation/docs/">index.coffee</a>を読んでわかったことのメモ。</p>

<h2 id="toc_0">nodes.coffee</h2>

<h3 id="toc_1">Code#compileNode()</h3>

<p>ノードをコンパイルする。
コンパイルの過程で<code>Scope</code>インスタンスが作成される。
オプションに親のスコープを渡すと<code>variables</code>は親のスコープ内で宣言された変数を考慮した変数のリストとなる。</p>

<pre><code class="coffeescript">options =
  scope: parent.scope
  indent: ''
code.compileNode options
scope = options.scope
console.log scope.variables
</code></pre>

<h2 id="toc_2">scope.coffee</h2>

<h3 id="toc_3">Scope#declaredVariables()</h3>

<p>スコープ内で<code>var</code>で宣言される変数の配列を返す。パラメータは含まれない。</p>

<p>スコープ内で定義される全ての名前空間を取得するためには、さらにパラメータを含む必要が有るため下記のコードを使う。
<code>coffeescript
declaredSymbols = (scope) -&gt;
  realVars = []
  tempVars = []
  for v in @variables when v.type is 'var' or v.type is 'param'
    (if v.name.charAt(0) is '_' then tempVars else realVars).push v.name
  realVars.sort().concat tempVars.sort()
</code></p>

    </div>
  </article>

  <a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <ul class="post-pagination">
    <li class="prev"><a rel="prev" href="http://localhost:1313/post/docpad">DocPad</a></li>
    <li class="next"><a rel="next" href="http://localhost:1313/post/access-to-title-in-ie8">Access to title in IE8</a></li>
  </ul>



    </ul>
    </div>
      </div>
    </div>
  </div>
</body>
</html>

