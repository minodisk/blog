+++
date = 2014-06-15T06:04:06Z
title = "Compassを改良する"
tags = [
  "Compass",
  "Ruby"
]
+++

Compassを使っていて発生する問題を、コンパイル時のパフォーマンスを損なわずに解決する方法。

## このパッチで解決する問題点

- スプライト画像の画像名内にキャッシュバスターが入っている。
- 異環境でコンパイル時に、背景画像のキャッシュバスターが書き換わってしまう。

## パッチ

config.rubyで`Compass`と`Sass`モジュールにモンキーパッチを当てる。

## コールバックを使う方法では解決できない問題点

既出の方法で`on_sprite_saved`コールバックでスプライト画像をリネームし、
`on_stylesheet_saved`でコンパイルされたCSSを書きなおすという解決法がある。
これは独立性の高い方法だが、CSSを書き直す度にスプライト画像が書き出されてしまい、
大きなスプライト画像を設定した場合にSassの保存からCSSコンパイル完了までに
非常に時間がかかってしまっていた。

## まとめ

スプライト画像を多く使うプロジェクトでは、コンパイル時に時間が掛かることで
Sassの編集作業がストレスを感じる作業になりがちだった。
作業軽減のために採用したCompassの利用でストレスを感じるのは本末転倒なので、
多少汚い方法でも今回紹介した方法を使ってみるとよいかと思う。
ただし、この方法は`Compass`と`Sass`モジュールのバージョンが変わったら
動かなくなる可能性は十分にあるので注意。
